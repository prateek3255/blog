<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Why using object spread with reduce probably a bad idea</title><meta name="description" content="Explore why using object spread with .reduce() can sometimes significantly affect the performance of your JavaScript apps and libraries."><link rel="canonical" href="undefined/blog/why-using-object-spread-with-reduce-bad-idea/"><link rel="apple-touch-icon" sizes="152x152" href="undefined/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="undefined/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="undefined/favicons/favicon-16x16.png"><link rel="manifest" href="undefined/favicons/site.webmanifest"><link rel="mask-icon" href="undefined/favicons/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><meta name="twitter:title" content="Why using object spread with reduce probably a bad idea"><meta property="twitter:description" content="Explore why using object spread with .reduce() can sometimes significantly affect the performance of your JavaScript apps and libraries."><meta name="twitter:image" content="undefined/img/why-using-object-spread-with-reduce-bad-idea.png"><meta name="twitter:card" content="summary_large_image"><meta property="og:title" content="Why using object spread with reduce probably a bad idea"><meta property="og:description" content="Explore why using object spread with .reduce() can sometimes significantly affect the performance of your JavaScript apps and libraries."><meta property="og:image" content="undefined/img/why-using-object-spread-with-reduce-bad-idea.png"><meta property="og:url" content="undefined/blog/why-using-object-spread-with-reduce-bad-idea/"><meta property="og:type" content="article"><link rel="stylesheet" type="text/css" href="undefined/css/style.css"><link rel="stylesheet" type="text/css" href="undefined/css/prism-tomorrow.css"><script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/brands.min.js"></script><script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/solid.min.js"></script><script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/fontawesome.min.js"></script><script>function trackTagClick(t){trackEvent("tag_clicked","tags",t)}function trackEvent(t,c,a){console.log("Event",{name:t,category:c,label:a})}</script><script async src="https://unpkg.com/smoothscroll-polyfill/dist/smoothscroll.min.js"></script><script async src="https://unpkg.com/smoothscroll-anchor-polyfill"></script><script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer="defer"></script></head><body><div class="w-full"><nav class="flex items-center justify-center lg:justify-between flex-wrap p-6 lg:px-0 container mx-auto" x-data="navbarData()" @keydown.escape="isOpen = false"><div class="flex items-center"><a href="/" aria-label="logo"><img src="/img/prateek-bitmoji.png" alt="Logo" height="80" width="63.2" class="h-20"></a></div><button x-on:click="handleToggle" type="button" class="ml-auto block lg:hidden px-2 text-primary-500 hover:text-primary-500 focus:outline-none focus:text-primary-500" :class="{ 'transition transform-180': isOpen }" aria-label="Menu"><svg class="h-6 w-6 fill-current" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path x-show="isOpen" fill-rule="evenodd" clip-rule="evenodd" d="M18.278 16.864a1 1 0 0 1-1.414 1.414l-4.829-4.828-4.828 4.828a1 1 0 0 1-1.414-1.414l4.828-4.829-4.828-4.828a1 1 0 0 1 1.414-1.414l4.829 4.828 4.828-4.828a1 1 0 1 1 1.414 1.414l-4.828 4.829 4.828 4.828z"/><path x-show="!isOpen" fill-rule="evenodd" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/></svg></button><div class="w-full flex-grow lg:flex lg:items-center lg:w-auto text-center transition-all duration-700 ease-in-out opacity-0 lg:opacity-100" :class="{ 'max-h-80 opacity-100': isOpen, 'max-h-0 opacity-0': !isOpen }" x-show.transition="true"><ul class="pt-6 lg:pt-0 list-reset lg:flex justify-end flex-1 items-center"><li class="nav__item mr-1"><a @click="isOpen = false" class="text-ml inline-block text-gray-500 no-underline hover:text-indigo-500 py-2 px-4" href="/">About</a></li><li class="nav__item mr-1"><a @click="isOpen = false" class="text-ml inline-block text-gray-500 no-underline hover:text-indigo-500 py-2 px-4" href="/blog">Blog</a></li><li class="nav__item mr-1"><a @click="isOpen = false" target="_blank" rel="noreferrer noopener" class="text-ml inline-block text-gray-500 no-underline hover:text-indigo-500 py-2 px-4" href="https://twitter.com/psuranas"><i class="fab fa-twitter"></i></a></li><li class="nav__item mr-1"><a @click="isOpen = false" target="_blank" rel="noreferrer noopener" class="text-ml inline-block text-gray-500 no-underline hover:text-indigo-500 py-2 px-4" href="https://github.com/prateek3255"><i class="fab fa-github"></i></a></li><li class="nav__item mr-1"><a @click="isOpen = false" target="_blank" rel="noreferrer noopener" class="text-ml inline-block text-gray-500 no-underline hover:text-indigo-500 py-2 px-4" href="https://stackoverflow.com/users/8252081/prateek-surana"><i class="fab fa-stack-overflow"></i></a></li><li class="nav__item mr-1"><a @click="isOpen = false" target="_blank" rel="noreferrer noopener" class="text-ml inline-block text-gray-500 no-underline hover:text-indigo-500 py-2 px-4" href="/blog/feed.xml"><i class="fas fa-rss"></i></a></li></ul></div></nav></div><script>function navbarData(){return{isOpen:!1,handleToggle(){this.isOpen=!this.isOpen,void 0!==window.annotationGroup&&(window.annotationGroup.hide(),setTimeout(()=>{window.annotationGroup.show()},800))}}}</script><div x-data="newsletter()" x-init="startTimer()"><div class="container max-w-3xl mt-6 px-6"><div class="pb-5 mb-5 border-b border-gray-100"><h1 class="font-bold text-5xl">Why using object spread with reduce probably a bad idea</h1><p class="text-center text-base leading-6 font-medium text-gray-500">Last updated on <time>13 Jun 2021</time> by Prateek Surana &nbsp; • &nbsp;<span class="read-time"> - min read</span></p></div><article class="prose lg:prose-xl my-4 relative"><p>This tweet regarding a simplified way to use reduce got a lot of attention recently in the JavaScript community.</p><div style="width:100%; display:flex; justify-content:center;"><blockquote class="twitter-tweet" style="margin-left:auto; margin-right:auto;" data-dnt="true" data-theme="light"><p lang="en" dir="ltr">Simplify your .reduce calls by doing as much work as possible in .filter and .map instead. Compare these two snippets. Which is more readable? Notice that when map arranges data exactly how we want, our .reduce can be just Object.assign.<a href="https://twitter.com/hashtag/typescript?src=hash&amp;ref_src=twsrc%5Etfw">#typescript</a> <a href="https://twitter.com/hashtag/javascript?src=hash&amp;ref_src=twsrc%5Etfw">#javascript</a> <a href="https://t.co/3TW57kaCar">pic.twitter.com/3TW57kaCar</a></p>&mdash; Rupert Foggo McKay (@maxfmckay) <a href="https://twitter.com/maxfmckay/status/1396252890721918979?ref_src=twsrc%5Etfw">May 22, 2021</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><p>If you see the replies, you'll find how most people are concerned over the fact that the 2nd method is worse (which also doesn't work as expected, as <a href="#reduce-object-assign-bug">we'll discuss later in this post</a>) because we are iterating the array thrice when in fact the former one is much slower. After all, the spread operator takes almost O(n) time, resulting in the overall time complexity of O(n<sup>2</sup>) for the first method. The latter is still O(n) (yes 3 times O(n) is still O(n), measuring 'hot paths' in code for time complexity is worthless) which is far better that O(n<sup>2</sup>) because of the exponential nature of the latter.</p><h2 class="relative"><a id="why-is-the-spread-operator-so-slow" href="#why-is-the-spread-operator-so-slow" class="header-anchor"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="absolute top-2 -left-7 opacity-0 icon" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg> Why is the spread operator so slow?</a></h2><p>The speed of the spread operator can vary depending upon how your JavaScript is getting compiled, but for the sake of this article, let's consider it is compiled using the v8 engine, which Node and Chrome use.</p><p>So let's assume we have a spread operator like this -</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span><br><br><span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj1<span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span></code></pre><p>Not going too deep into the implementation details of how it works, but when you use the spread operator like the above example, the compiler has to do a bunch of stuff like creating a new object literal, iterating and copying the <code>obj1</code> keys to the new object, and then adding the new keys ( <code>c: 'foo'</code> ).</p><p>Let's take this example where we convert an array of objects to an object via reduce -</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'ironman'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Tony Stark'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'hulk'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Bruce Banner'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'blackwidow'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Natasha Romanoff'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">]</span><br><br><span class="token keyword">const</span> superheroes <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><br>  <span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token operator">...</span>acc<span class="token punctuation">,</span><br>    <span class="token punctuation">[</span>item<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here the <code>reduce</code> loop runs n times for the array (where n is the number of items in the array). And as we discussed earlier, there is an invisible inner loop here as well with the spread operator that copies the existing accumulator keys to the new object.</p><p>Although the inner loop doesn't exactly run n times because it depends on the number of keys currently present in the accumulator, which grows with every iteration of the outer loop.</p><p>To simplify the above paragraph, this is how it works -</p><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// First iteration</span><br>acc <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <br><span class="token punctuation">{</span> <span class="token operator">...</span>acc<span class="token punctuation">,</span> ironman<span class="token operator">:</span> <span class="token string">'Tony Stark'</span> <span class="token punctuation">}</span><span class="token comment">// No key needs to be copied</span><br><br><span class="token comment">// Second iteration</span><br>acc <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span> ironman<span class="token operator">:</span> <span class="token string">'Tony Stark'</span> <span class="token punctuation">}</span> <br><span class="token punctuation">{</span> <span class="token operator">...</span>acc<span class="token punctuation">,</span> hulk<span class="token operator">:</span> <span class="token string">'Bruce Banner'</span> <span class="token punctuation">}</span> <span class="token comment">// 1 key from the accumulator </span><br><span class="token comment">// would be copied to the new object</span><br><br><span class="token comment">// Thrid iteration</span><br>acc <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span> ironman<span class="token operator">:</span> <span class="token string">'Tony Stark'</span><span class="token punctuation">,</span> hulk<span class="token operator">:</span> <span class="token string">'Bruce Banner'</span> <span class="token punctuation">}</span> <br><span class="token punctuation">{</span> <span class="token operator">...</span>acc<span class="token punctuation">,</span> blackwidow<span class="token operator">:</span> <span class="token string">'Natasha Romanoff'</span> <span class="token punctuation">}</span> <span class="token comment">// 2 keys from the accumulator </span><br><span class="token comment">// would be copied to the new object </span><br><br><span class="token comment">// ... and so on</span></code></pre><p>So even though the inner loop doesn't exactly run n times on every iteration, it's safe to say that it's in the same class of solutions that execute n<sup>2</sup> times, so we can say its O(n<sup>2</sup>).</p><blockquote><p>I am assuming here that no duplicate keys are generated in the target object because the time complexity would still be classified as O(n<sup>2</sup>), but the actual run time will vary depending upon the number of duplicate keys since the size of the accumulator would vary accordingly with every iteration.</p></blockquote><p>But what if you're using some transpiler like <a href="https://babeljs.io/">Babel</a> or <a href="https://www.typescriptlang.org/play">TypeScript's transpiler</a> and targeting ES5 (which we generally do to support older browsers).</p><p>Well, first, if you see the specification of the <a href="https://github.com/tc39/proposal-object-rest-spread/blob/master/Spread.md">object rest spread proposal on tc39</a>, you will see that -</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> ab <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>a<span class="token punctuation">,</span> <span class="token operator">...</span>b <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Desugars to - </span><br><span class="token keyword">let</span> ab <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>Here, the desugared syntax also has a similar time complexity as the spread operator because it is doing pretty much the same thing, creating a new object and then iterating and copying the keys of the remaining objects to the new object.</p><p>Babel transpiles the <a href="https://babeljs.io/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&amp;build=&amp;builtIns=false&amp;corejs=false&amp;spec=true&amp;loose=true&amp;code_lz=MYewdgzgLgBCBGArAjDAvDA3jAHgLhgE4YBfAKDNElgUQCZ0sYBPA5ABlIqul0ewB0Q2sgA0MIQNp1xALwIAOEjDJA&amp;debug=false&amp;forceAllTransforms=true&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=true&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=script&amp;lineWrap=true&amp;presets=env%2Creact&amp;prettier=false&amp;targets=&amp;version=7.14.3&amp;externalPlugins=">spread syntax to something similar to the desugared TC39 proposal</a>. Although <a href="https://www.typescriptlang.org/play?#code/MYewdgzgLgBCBGArAjDAvDA3jAHgLhgE4YBfAWAChLRJYFEAmdLGATwOQAZTLrxpczbADpR9ZABoYo4fQZSAXgQAcJGJSA">TypeScripts transpiler creates nested <code>Object.assign</code> calls</a>, which I'm not sure why.</p><p>If you want to get into the weeds of what I tried to explain above, you can refer to <a href="https://www.richsnapp.com/article/2019/06-09-reduce-spread-anti-pattern">this awesome</a> article by <a href="https://twitter.com/snapwich">Rich snapp</a> that covers the same topic in much greater detail.</p><h2 class="relative"><a id="the-better-solution" href="#the-better-solution" class="header-anchor"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="absolute top-2 -left-7 opacity-0 icon" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg> The better solution</a></h2><p>So what is the right way of converting an array to an object like this? Well, there are many ways, and if you see the Twitter thread, you will see a lot of people arguing about how some methods are faster than others. I won't be covering all that, but speaking strictly in terms of time complexity, here is my favorite one -</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    result<span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In the above method since we are mutating the result object directly the complexity here is O(n), also its more readable as well.</p><p>This method using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries"><code>Object.fromEntries</code></a> is also very neat because <code>Object.fromEntries</code> is built to convert iterables to object.</p><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> filteredUsers <span class="token operator">=</span> users<br>  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>active<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> result <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>filteredUsers<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="bg-blue-100 px-9 py-1 rounded-md mt-12 relative" x-data="{ showMore: false }" id="reduce-object-assign-bug"><div class="absolute p-2 bg-white rounded-full" style="top:-14px; left:-14px;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div><p>Lastly, let's talk about the method that the tweet author suggested. As I mentioned initially, it might look much worse, but 3x O(n) is still O(n), so complexity wise we are probably good. Still, a small mistake leads to a slightly unexpected result and a significantly worse performance.</p><pre class="language-jsx"><code class="language-jsx">users<br>  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>active<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> user<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><button x-show.transition.opacity.duration.100ms="!showMore" x-on:click="showMore = !showMore" class="flex gap-1 m-0 p-0 border-none bg-transparent items-center font-bold mb-3 mt-4">Show more <span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span></button><div x-cloak x-show.transition.opacity.duration.300ms="showMore"><p>The problem here is in the <code>reduce</code> call where we directly pass <code>Object.assign</code> to it. If you check the documentation for <code>reduce</code> you'll find that it passes the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce#how_reduce_works">following arguments to the callback function</a> -</p><pre class="language-jsx"><code class="language-jsx">arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> currentValue<span class="token punctuation">,</span> currentIndex<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Ommitted for brevity</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> initialValue<span class="token punctuation">)</span></code></pre><p>So we end up passing all these parameters to <code>Object.assign</code>, which increases the complexity of the operation and returns a slightly weird result. To understand, let's take a look at one of the iterations of the <code>reduce</code> call -</p><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// users = [</span><br><span class="token comment">//  { id: 'id1', name: 'foo', active: true }, </span><br><span class="token comment">//  { id: 'id2', name: 'bar', active: true }</span><br><span class="token comment">// ]</span><br><br><span class="token comment">// After the processing data is done by the filter and map</span><br><span class="token comment">// functions, this gets passed to the Object.assign in the first</span><br><span class="token comment">// iteration of the  reduce</span><br><br>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id1<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id1<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id2<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br><span class="token comment">// Let's take a look at the arguments being passed -</span><br><br><span class="token comment">// First argument is the accumulator which for the first iteration is </span><br><span class="token comment">// an empty object - {}</span><br><br><span class="token comment">// Second argument is the currentValue which is the first item from </span><br><span class="token comment">// the array generated by the preceding map - { id1: 'foo' }</span><br><br><span class="token comment">// Third argument is the currentIndex which represents the index of the</span><br><span class="token comment">// current item - 0</span><br><br><span class="token comment">// Last argument is the array itself which is generated by map in the </span><br><span class="token comment">// previous step - [{ id1: 'foo' }, { id2: 'bar' }]</span></code></pre><p>The first two arguments are what we expected, the third argument being <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#primitives_will_be_wrapped_to_objects">a number doesn't have any effect,</a> the last argument is where the problem starts. Since arrays are also objects in JavaScript, they are also copied via <code>Object.assign</code> with their indexes as the keys. You can view the <a href="https://replit.com/@prateek3255/object-assign-bug#index.js">generated result in this repl</a>.</p><p>The correct way would be to pass only required arguments to <code>Object.assign</code> -</p><pre class="language-jsx"><code class="language-jsx">users<br>  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>active<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> user<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> currentValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> currentValue<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://twitter.com/jaffathecake">Jake</a> wrote a really nice article about this pattern explaining <a href="https://jakearchibald.com/2021/function-callback-risks/">why you shouldn't use functions as callbacks unless they're designed for it</a>.</p></div></div><h2 class="relative"><a id="wait-isnt-this-premature-optimization" href="#wait-isnt-this-premature-optimization" class="header-anchor"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="absolute top-2 -left-7 opacity-0 icon" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg> Wait, isn't this premature optimization?</a></h2><p>As much as I want to say it is, it's probably not. Since the reduce with spread technique is exponential in nature, it gets gruesome with just a little increase in data.</p><p>Take <a href="https://replit.com/@prateek3255/reduce-timings#index.js">this repl running on Node 12</a>, for example. You can see how the time taken goes from just a couple of milliseconds for 10 times to a few 100 ms for 100 items and a staggering 1-2 seconds for 1000 items. Meanwhile, the difference between the rest of O(n) methods stays under 10ms for all the cases.</p><p>The results could be even worse if you're running this on a browser and your users are using some low-powered devices. You could block the main thread and block any interactions for a few hundred milliseconds, resulting in a very laggy UX.</p><picture><source type="image/webp" srcset="/img/comparison-computational-complexity-480.webp 480w, /img/comparison-computational-complexity-768.webp 768w, /img/comparison-computational-complexity-1200.webp 1200w" sizes="(max-width: 600px) 480px, (max-width: 1024px) 768px, 1200px"><source type="image/jpeg" srcset="/img/comparison-computational-complexity-480.jpeg 480w, /img/comparison-computational-complexity-768.jpeg 768w, /img/comparison-computational-complexity-1200.jpeg 1200w" sizes="(max-width: 600px) 480px, (max-width: 1024px) 768px, 1200px"><img src="../img/comparison-computational-complexity-768.jpeg" width="768" height="664" alt="Comparing computational complexity of different Big O notations" class="article-img" loading="lazy" decoding="async"></picture><p>So if we were arguing amongst the O(n) methods that we discussed in the previous section, then that probably would have been a case for premature optimization but not this. Since as its clear from the above graph how the reduce with spread method (with O(n<sup>2</sup>) complexity) gets considerably worse with the increasing input size.</p><h2 class="relative"><a id="conclusion" href="#conclusion" class="header-anchor"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="absolute top-2 -left-7 opacity-0 icon" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg> Conclusion</a></h2><p>So, in conclusion, you should try to avoid this pattern in your code, even if you think that the data set is small enough to have any significant impact on performance because you may end up using this method in places where it actually hampers the performance.</p><a class="fixed bottom-12 bg-white text-accent-blue flex items-center justify-center rounded cursor-pointer z-10 invisible lg:visible top-indicator-container" aria-label="Scroll to top" href="#"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="top-indicator" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 217.9L383 345c9.4 9.4 24.6 9.4 33.9 0 9.4-9.4 9.3-24.6 0-34L273 167c-9.1-9.1-23.7-9.3-33.1-.7L95 310.9c-4.7 4.7-7 10.9-7 17s2.3 12.3 7 17c9.4 9.4 24.6 9.4 33.9 0l127.1-127z"></path></svg></a></article><hr class="my-4"><div class="text-md mb-3 flex justify-between flex-col md:flex-row"><div><a href="/blog/tags/javascript" onclick='trackTagClick("javascript")' class="text-indigo-700 mr-1">#JavaScript </a><a href="/blog/tags/best-practices" onclick='trackTagClick("best-practices")' class="text-indigo-700 mr-1">#Best-Practices</a></div><div class="mt-2 md:mt-0"><span class="font-bold mr-2">Enjoyed this blog, share it on: </span><a href="https://twitter.com/intent/tweet?url=undefined/blog/why-using-object-spread-with-reduce-bad-idea/&via=psuranas&text=Why using object spread with reduce probably a bad idea" target="_blank" rel="noreferrer noopener" class="text-indigo-700 mr-1">Twitter </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=undefined/blog/why-using-object-spread-with-reduce-bad-idea/" target="_blank" rel="noreferrer noopener" class="text-indigo-700">LinkedIn</a></div></div></div><div class="container max-w-3xl border-gray-100 border-2 p-8 shadow rounded flex flex-col items-center md:flex-row mb-6 mt-8 bg-blue-100"><div class="text-center"><h4 class="text-lg font-bold mb-2">Want to get better at React, JavaScript, and TypeScript?</h4><p class="text-base">I regularly publish posts like this one, containing best practices, tips, and tutorials on React, JavaScript, and TypeScript. Subscribe to my newsletter to get them straight to your inbox. No spam ever. Unsubscribe at any time. You can also <a target="_blank" rel="noreferrer noopener" class="underline" href="/blog/feed.xml">subscribe via RSS</a>.</p><form x-on:submit="handleSubscribe" name="subscribe_card"><input name="email" x-model="emailField" required type="email" placeholder="john@doe.com" class="input-primary mt-6"> <button x-bind:disabled="isSubscribeLoading" class="btn-primary" type="submit">Count me in</button></form></div></div><div class="container max-w-3xl border-gray-100 border-2 p-8 shadow rounded flex flex-col items-center md:flex-row mb-6 mt-8"><div class="mb-4 md:mb-0 md:mr-8 md:flex-shrink-0"><img alt="Prateek Surana" height="20" width="20" class="h-20 w-20 rounded-full border-indigo-500 border-2" src="/img/prateek-author.jpg"></div><div class="md:text-left text-center"><h4 class="text-lg font-bold mb-2 md:mb-0">About Prateek Surana</h4><p class="text-base">Prateek is a Frontend Engineer and an iOS developer, currently building <a href="https://devfolio.co" class="text-indigo-700" target="_blank" rel="noreferrer noopener">Devfolio</a>. Apart from his unconditional love for JavaScript and React, he also enjoys watching Marvel movies and playing quirky games on his phone.</p></div></div><div x-cloak x-show.transition.duration.300ms="showSubscribePopup" class="fixed border-gray-100 border-2 p-6 shadow rounded bottom-7 right-7 w-72 ml-auto xl:block hidden bg-blue-100 z-20"><img src="/img/subscribe-banner-image.png" alt="Subscribe to newsletter" style="top:-130px; right:79px;" class="absolute h-32"><div class="flex w-full justify-between mb-2"><h4 class="text-lg font-bold mb-2">Want to get better at React, JavaScript, and TypeScript?</h4><img src="/img/cross-black.svg" x-on:click="hideSubscribePopup" alt="Close the banner" class="h-5 mt-1 cursor-pointer"></div><p class="text-base">I regularly publish posts like this one, containing best practices, tips, and tutorials on React, JavaScript, and TypeScript.</p><br><p class="text-base">Subscribe to my newsletter to get them straight to your inbox. No spam ever. Unsubscribe at any time.</p><form x-on:submit="handleSubscribe" name="subscribe_popup"><input name="email" x-model="emailField" required type="email" placeholder="john@doe.com" class="input-primary mt-6"> <button x-bind:disabled="isSubscribeLoading" class="btn-primary" type="submit">Count me in</button></form></div></div><script>function newsletter(){return{showSubscribePopup:!1,isSubscribeLoading:!1,emailField:"",hideSubscribePopup(){trackEvent("closed_subscribe_popup","subscribe"),this.showSubscribePopup=!1,localStorage.setItem("has-hidden-subscription-popup",!0)},handleSubscribe(e){e.preventDefault(),trackEvent(`clicked_on_subscribe_from_${e.target.name}`,"subscribe",e.target.name),this.isSubscribeLoading=!0;fetch("http://localhost:3000/api/register",{method:"POST",body:JSON.stringify({email:this.emailField})}).then(e=>e.json()).then(e=>{this.isSubscribeLoading=!1,this.emailField="",e.success?(window.location.href="undefined/confirm",this.showSubscribePopup=!1,localStorage.setItem("has-hidden-subscription-popup",!0)):alert(e.message)}).catch(e=>{this.isSubscribeLoading=!1,alert("Something went wrong, please refresh the page and try again!")})},startTimer(){clearTimeout(window.currentTimer),localStorage.getItem("has-hidden-subscription-popup")||(window.currentTimer=setTimeout(()=>{this.showSubscribePopup=!0},15e3),window.onscroll=()=>{document.body.offsetHeight-(window.innerHeight+window.scrollY)<=550&&(this.showSubscribePopup=!1)})}}}</script><footer class="bottom-0 text-center w-full py-8 px-1 md:px-0"><small class="text-gray-500">Copyright © Prateek&#39;s Blog <span id="copyright"><script>document.getElementById("copyright").appendChild(document.createTextNode((new Date).getFullYear()))</script></span>. Made with <a href="https://www.11ty.dev/" target="_blank" rel="noreferrer noopener" class="underline">Eleventy,</a> <a href="https://tailwindcss.com/" target="_blank" rel="noreferrer noopener" class="underline">Tailwind CSS</a>, and ❤&nbsp; by <a href="https://prateeksurana.me/" target="_blank" rel="noreferrer noopener" class="underline">Prateek Surana</a> • <a href="https://github.com/prateek3255/blog/edit/master/./src/blog/why-using-object-spread-with-reduce-bad-idea.md" class="underline" target="_blank" rel="noreferrer noopener">Edit this page on GitHub</a></small></footer><script>var textContent,str,wordCount,readingTimeInMinutes,readingTimeAsString,article=document.getElementsByTagName("article")[0],readTime=document.getElementsByClassName("read-time")[0];article&&readTime&&(wordCount=(str=(str=(str=(textContent=article.textContent).replace(/(^\s*)|(\s*$)/gi,"")).replace(/[ ]{2,}/gi," ")).replace(/\\n /,"\\n")).split(" ").filter(e=>"\\n"!==e).length,readingTimeInMinutes=Math.floor(wordCount/228)+1,readTime.innerText=readingTimeAsString=readingTimeInMinutes+" min read")</script></body></html>